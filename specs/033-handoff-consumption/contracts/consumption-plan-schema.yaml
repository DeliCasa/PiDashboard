# Consumption Plan Schema
# YAML frontmatter schema for consumption plan documents
#
# Location: specs/<handoff_id>-consumption/plan.md
# Example: specs/031-backend-gaps-consumption/plan.md

$schema: http://json-schema.org/draft-07/schema#
title: ConsumptionPlanFrontmatter
description: YAML frontmatter for handoff consumption plan documents

type: object
required:
  - handoff_id
  - source_handoff
  - status
  - created_at
  - requirements_total

properties:
  handoff_id:
    type: string
    pattern: "^[0-9]{3}-[a-z][a-z0-9-]*$"
    description: "Source handoff ID (e.g., 031-backend-gaps)"
    examples:
      - "031-backend-gaps"
      - "028-api-compat"

  source_handoff:
    type: string
    description: "Path to source handoff file relative to repo root"
    examples:
      - "docs/HANDOFF_031_PIORCHESTRATOR_BACKEND_GAPS.md"

  status:
    type: string
    enum:
      - pending
      - in_progress
      - testing
      - review
      - done
      - blocked
    description: "Current status of consumption plan"

  created_at:
    type: string
    format: date-time
    description: "ISO 8601 timestamp when plan was created"

  updated_at:
    type: string
    format: date-time
    description: "ISO 8601 timestamp when plan was last updated"

  requirements_total:
    type: integer
    minimum: 0
    description: "Total number of extracted requirements"

  requirements_done:
    type: integer
    minimum: 0
    description: "Number of completed requirements"
    default: 0

  blocker_reason:
    type: string
    description: "If status is blocked, explains why"

additionalProperties: false

# Validation constraints
allOf:
  - if:
      properties:
        status:
          const: blocked
    then:
      required:
        - blocker_reason

# Example valid frontmatter:
# ---
# handoff_id: "031-backend-gaps"
# source_handoff: "docs/HANDOFF_031_PIORCHESTRATOR_BACKEND_GAPS.md"
# status: in_progress
# created_at: "2026-01-13T12:00:00Z"
# updated_at: "2026-01-13T14:30:00Z"
# requirements_total: 8
# requirements_done: 3
# ---
